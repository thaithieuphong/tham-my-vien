<link rel="stylesheet" href="/css/root.css">
<link rel="stylesheet" href="/css/assistant.css">
<div class="sticky-top">
	<nav class="navbar navbar-light bg-blue border-bottom">
		<a type="button" href="/operating-room/nursing">
			<i class="fa-solid fa-circle-arrow-left text-light fs-3"></i>
		</a>
        <div class="text-light text-uppercase fw-bold">
            {{title}}
        </div>
		<div class="img-container">
		</div>
    </nav>
</div>
<div class="container-fluid">
	{{#if messages_createReExamination_success}}
	<div class="alert alert-success alert-dismissible fade show mt-2" role="alert">
		{{messages_createReExamination_success}}
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	</div>
	{{/if}}
	<div class="row p-3">
		{{#if serviceNotes}}
			<div class="card bg-glass p-0">
				<div class="card-header bg-transparent">
					<div class="row">
						<div class="input-group input-group-sm">
							<label class="input-group-text text-light bg-danger"><em>{{serviceNotes.status}}</em></label>
							<label class="input-group-text text-light bg-success"><em>{{formatDate serviceNotes.schedule}}</em></label>
						</div>
					</div>
				</div>
				<div class="card-body p-3">
					<div class="row mb-3">
						<div class="col-md-6 mb-3">
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Khách hàng</span>
								<input class="form-control" type="text" value="{{serviceNotes.customerID.firstName}} {{serviceNotes.customerID.lastName}}" name="fullName">
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Ngày sinh</span>
								<input class="form-control" type="date" value="{{serviceNotes.customerID.birth}}" name="birth">
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Giới tính</span>
								<select class="form-select" id="select-gender">
									<option selected>Chọn giới tính...</option>
									<option value="Nam">Nam</option>
									<option value="Nữ">Nữ</option>
								</select>
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">SĐT</span>
								<input class="form-control" type="text" value="{{serviceNotes.customerID.phone}}">
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Bác sĩ:</span>
								<select multiple="multiple" id="select-doctor" class="form-select text-light bg-transparent" name="performer[]">
									{{#each doctors}}
									<option value="{{this._id}}">{{this.firstName}} {{this.lastName}}</option>
									{{/each}}
								</select>
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Phụ mổ:</span>	
								<select multiple="multiple" id="select-nursing" class="form-control" name="nursing[]">
									{{#each nursings}}
									<option value="{{this._id}}">{{this.firstName}} {{this.lastName}}</option>
									{{/each}}
								</select>
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Dẫn khách:</span>
								<select multiple="multiple" id="select-recept" class="form-control" name="recept[]">
									{{#each nursings}}
									<option value="{{this._id}}">{{this.firstName}} {{this.lastName}}</option>
									{{/each}}
								</select>
							</div>
							{{!-- <button class="btn btn-primary btn-sm btn-mobile">Cập nhật</button> --}}
						</div>
						<div class="col-md-6 mb-3">
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Dịch vụ</span>
								<span class="input-group-text bg-info text-light text-right">{{serviceNotes.service}}</span>
								<span id="price-before" class="input-group-text bg-danger text-light text-right">{{serviceNotes.price}}</span>
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Thêm dịch vụ</span>
								<select class="form-select" id="select-service">
									{{#each typeService}}
									<option class="fw-bold text-uppercase" disabled>{{this.name}}</option>
										{{#each this.services}}
											<option value="{{this.service}}">{{this.service}}</option>
										{{/each}}
										<br>
									{{/each}}
								</select>
								<button id="add-services" class="btn bg-blue-ray text-light border-light btn-sm"><i class="ti-plus"></i></button>
							</div>
							<div class="list-group mb-3 height-300">
								<div id="service-container" class="list-group-item bg-glass container-content-page p-2 ml-0">
								
								</div>
							</div>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text text-light bg-blue">Tổng chi phí</span>
								<input id="total" class="form-control text-right text-danger fw-bold" type="text">
							</div>
						</div>
					</div>
					<form method="POST" id="submit-doctor-form">
						<div class="accordion accordion-flush" id="accordionFlush-{{serviceNotes._id}}">
							<div class="accordion-item">
								<h2 class="accordion-header" id="flush-counselor-{{serviceNotes._id}}">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-counselor-{{serviceNotes._id}}" aria-expanded="false" aria-controls="flush-collapse-counselor-{{serviceNotes._id}}">
										Thông tin tư vấn
									</button>
								</h2>
								<div id="flush-collapse-counselor-{{serviceNotes._id}}" class="accordion-collapse collapse" aria-labelledby="flush-counselor-{{serviceNotes._id}}" data-bs-parent="#accordionFlush-{{serviceNotes._id}}">
									<div class="accordion-body">
										<div class="row">
											<div class="">
												<label for="steps-to-take-area"><strong>Nội dung tư vấn:</strong></label>
											</div>
											<div class="">
												<textarea style="width: inherit;" class="form-control mr-3 pl-3 bg-white" name="notes" id="notes-area" cols="30" rows="8"></textarea>
											</div>
											<div class="col-md-6">
												{{#if serviceNotes.counselorImg}}
												{{#each serviceNotes.counselorImg}}
												<div class="col-xl-2 col-lg-3 col-md-4">
													<figure class="figure imgbox">
														<img src="{{this.url}}" class="figure-img img-fluid rounded upd-ava" alt="...">
													</figure>
												</div>
												{{/each}}
												{{else}}
												<p class="text-center">
													Chưa có hình ảnh
												</p>
												{{/if}}
												<form method="POST" id="upload-img-counselor-form-{{serviceNotes._id}}" action="/operating-room/nursing/service-note/counselor/{{serviceNotes._id}}" enctype="multipart/form-data">
													<input hidden type="text" value="{{serviceNotes.customerID._id}}" name="customerID">
													<div class="preview-images-counselor row ml-0 border text-center"></div>
													<div class="input-group">
														<button for="input-multi-images-counselor" class="btn btn-primary" data-input-img-id="{{serviceNotes._id}}">
															<i class="ti-cloud-up pr-1"></i>Tải ảnh lên
														</button>
														<input id="input-multi-images-counselor" class="form-control" type="file"
															name="counselor" multiple>
													</div>
												</form>
											</div>
											<div class="col-md-6">
												{{#if serviceNotes.counselorVideo}}
												{{#each serviceNotes.counselorVideo}}
												<div class="col-xl-2 col-lg-3 col-md-4">
													<figure class="figure img-container">
														<video src="{{this.url}}" class="figure-img img-fluid rounded img-cover" alt="..." controls></video>
													</figure>
												</div>
												{{/each}}
												{{else}}
												<p class="text-center">
													Chưa có video
												</p>
												{{/if}}
												<div class="preview-videos-counselor row ml-0 border text-center"></div>
												<div class="input-group">
													<button id="input-multi-videos-counselor-label" for="input-multi-videos-counselor" class="btn btn-primary">
														<i class="ti-cloud-up pr-1"></i>Tải video lên
													</button>
													<input id="input-multi-videos-counselor" class="form-control" type="file"
														name="counselor" multiple>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="accordion-item">
								<h2 class="accordion-header" id="flush-before-{{serviceNotes._id}}">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-before-{{serviceNotes._id}}" aria-expanded="false" aria-controls="flush-collapse-before-{{serviceNotes._id}}">
										Thông tin trước phẩu
									</button>
								</h2>
								<div id="flush-collapse-before-{{serviceNotes._id}}" class="accordion-collapse collapse" aria-labelledby="flush-before-{{serviceNotes._id}}" data-bs-parent="#accordionFlush-{{serviceNotes._id}}">
									<div class="accordion-body">
										<div class="row">
											
										</div>
									</div>
									<form method="POST" id="upload-img-counselor-form-{{serviceNotes._id}}" action="/operating-room/nursing/service-note/counselor/{{serviceNotes._id}}" enctype="multipart/form-data">
										<div class="row">
											<input hidden type="text" value="{{serviceNotes.customerID._id}}" name="customerID">
											<div class="col-sm-6 mt-3">
												<div class="preview-images-counselor row ml-0 border text-center">
												</div>
												<label for="input-multi-images-counselor" class="label-avt d-flex justify-content-start mt-3" data-input-img-id="{{serviceNotes._id}}">
													<h5 id="text-img-counselor" class="btn btn-primary text-uppercase btn-mobile"><i class="ti-cloud-up fw-bold"></i> Chọn ảnh tư vấn</h5>
												</label>
												<input id="input-multi-images-counselor" class="form-control" type="file"
													name="counselor" hidden multiple>
											</div>
											<div class="col-sm-6 mt-3">
												<div class="preview-videos-counselor row ml-0 border text-center">
												</div>
												<label id="input-multi-videos-counselor-label" for="input-multi-videos-counselor" class="label-avt d-flex justify-content-end mt-3">
													<h5 class="btn btn-primary text-uppercase btn-mobile"><i class="ti-cloud-up fw-bold"></i> Chọn video tư vấn</h5>
												</label>
												<input id="input-multi-videos-counselor" class="form-control" type="file"
													name="counselor" hidden multiple>
											</div>
										</div>
										<div class=" d-flex justify-content-center mt-3">
											<button type="submit" class="btn btn-primary btn-mobile">Tải lên</button>
										</div>
									</form>
								</div>
							</div>
							<div class="accordion-item">
								<h2 class="accordion-header" id="flush-after-{{serviceNotes._id}}">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-after-{{serviceNotes._id}}" aria-expanded="false" aria-controls="flush-collapse-after-{{serviceNotes._id}}">
										Thông tin hậu phẩu - hồi sức
									</button>
								</h2>
								<div id="flush-collapse-after-{{serviceNotes._id}}" class="accordion-collapse collapse" aria-labelledby="flush-after-{{serviceNotes._id}}" data-bs-parent="#accordionFlush-{{serviceNotes._id}}">
									<div class="accordion-body">
										<div class="row">
											
										</div>
									</div>
									<form method="POST" id="upload-img-counselor-form-{{serviceNotes._id}}" action="/operating-room/nursing/service-note/counselor/{{serviceNotes._id}}" enctype="multipart/form-data">
										<div class="row">
											<input hidden type="text" value="{{serviceNotes.customerID._id}}" name="customerID">
											<div class="col-sm-6 mt-3">
												<div class="preview-images-counselor row ml-0 border text-center">
												</div>
												<label for="input-multi-images-counselor" class="label-avt d-flex justify-content-start mt-3" data-input-img-id="{{serviceNotes._id}}">
													<h5 id="text-img-counselor" class="btn btn-primary text-uppercase btn-mobile"><i class="ti-cloud-up fw-bold"></i> Chọn ảnh tư vấn</h5>
												</label>
												<input id="input-multi-images-counselor" class="form-control" type="file"
													name="counselor" hidden multiple>
											</div>
											<div class="col-sm-6 mt-3">
												<div class="preview-videos-counselor row ml-0 border text-center">
												</div>
												<label id="input-multi-videos-counselor-label" for="input-multi-videos-counselor" class="label-avt d-flex justify-content-end mt-3">
													<h5 class="btn btn-primary text-uppercase btn-mobile"><i class="ti-cloud-up fw-bold"></i> Chọn video tư vấn</h5>
												</label>
												<input id="input-multi-videos-counselor" class="form-control" type="file"
													name="counselor" hidden multiple>
											</div>
										</div>
										<div class=" d-flex justify-content-center mt-3">
											<button type="submit" class="btn btn-primary btn-mobile">Tải lên</button>
										</div>
									</form>
								</div>
							</div>
						</div>
						<div class="row mt-3">
							<div class="">
								<label for="steps-to-take-area" class="text-light"><strong>Các bước thực hiện:</strong></label>
							</div>
							<div class="">
								<textarea style="width: inherit;" class="form-control mr-3 pl-3 bg-white" name="stepsToTake" id="steps-to-take-area" cols="30" rows="8"></textarea>
							</div>
						</div>
					</form>
					<hr class="mt-3 mb-3">
				</div>
				<div class="card-footer bg-transparent d-flex justify-content-end">
					<button type="button" data-bs-toggle="modal" data-bs-target="#submit-doctor-modal"
						class="btn btn-success btn-mobile" data-id="{{serviceNotes._id}}">Hoàn thành</button>
				</div>
			</div>
		{{else}}
		<div class="text-center">
			Chưa có phiếu phẩu thuật
		</div>
		{{/if}}
	</div>
</div>

<!-- Restore service note modal -->
<div class="modal fade" id="restore-service-note-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Khôi phục phiếu dịch vụ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bạn có chắc muốn khôi phục phiếu dịch vụ của <strong id="restore-service-note"></strong> không?
      </div>
      <div class="modal-footer">
        <button id="restore-service-note-btn" type="button" class="btn btn-danger">Chắc chắn</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy bỏ</button>
      </div>
    </div>
  </div>
</div>

<script src="/js/operating/nursing.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
	
	$(document).ready(function(){
		$("#select-doctor").bsMultiSelect();
		$("#select-nursing").bsMultiSelect();
		$("#select-recept").bsMultiSelect();
	})
})
</script>